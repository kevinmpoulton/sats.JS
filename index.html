<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
	<link rel="stylesheet" href="main.css">

    <title>SATS.JS</title>
  </head>

  <body>
	<div class="container">
		<div class="row">
			<div class="col-12">
				<b>SATS.JS by Kevin Poulton M0VXY</b>
				<p>This tool is designed to give you a snapshot of upcoming amateur satellites over your location. Written in native javascript,
					with the prediction code being based on BASIC routines taken from the 1980's classic 'Amateur Radio Software' by John Morris GM4ANB.</p>
				<p>If you have any questions feel free to e-mail me <a href="mailto:kevin@secondinternet.com">kevin@secondinternet.com</a></p>
			</div>
		</div>
		<div class="row">
			<div class="col-4">
				<label for="location_tb" class="form-label">Location (maidenhead)</label>
			</div>
			<div class="col-4">
				<input onKeyUp="javascript:updateButton();" type="text" class="form-control" id="location_tb" placeholder="(e.g. io91xo)">
			</div>
			<div class="col-4">
				<button onClick="javascript:submitForm();" id="predict_button" disabled class="btn btn-primary ">Predict</button>
			</div>
		</div>
		<div id="div_passes">
		</div>
	</div>
	
	  
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
	<script src="Location.class.js"></script>
	<script src="Satellite.class.js"></script>
	<script src="main.js"></script>
	
	<script>
		
		let predictButton = document.getElementById('predict_button')
		let locationTextField = document.getElementById('location_tb')
		
		/* Pre-populate the maidenhead square locator if it is provided as a get parameter */
		const urlParams = new URLSearchParams(window.location.search)
		const stationLocationParam = urlParams.get('station_location')

		let stationLocation = new Location(stationLocationParam)
		
		if(stationLocation.valid) {
			locationTextField.value = stationLocation.maidenhead
		}

		updateButton();
		
		function submitForm() {
			result = predict_passes(stationLocation)
			if(result !== true) {
				error = document.getElementById('div_passes')
				error.innerHTML = `<div class="row mt-2"><div class="col-7 alert alert-danger" role="alert">${result}</div></div>`
			}
		}

		function updateButton() {
			 stationLocation = new Location(locationTextField.value)

			if(!stationLocation.valid) {
				predictButton.disabled = true;
				predictButton.innerHTML = 'Enter a valid location'
				return
			}
			
			if(analysis_step != 3) {
				predictButton.disabled = true;
				predictButton.innerHTML = 'Loading ' + (files_to_load-files_loaded) + ' files.'
				setTimeout(updateButton,100)
				return
			}

			predictButton.disabled = false;
			predictButton.innerHTML = 'Press to refresh'
			submitForm()


		}
	</script>

  </body>
</html>